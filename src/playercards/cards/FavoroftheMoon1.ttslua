VALID_TOKENS = {
  ["Curse"] = true
}

SHOW_SINGLE_RELEASE = true
KEEP_OPEN = true

require("playercards/CardsThatSealTokens")

local playmatApi = require("playermat/PlaymatApi")
local guidReferenceApi = require("core/GUIDReferenceApi")
local chaosBagApi      = require("chaosbag/ChaosBagApi")
local contextMenuAdded


function onCollisionEnter()
  if contextMenuAdded then return end
  contextMenuAdded = true
  self.addContextMenuItem("Resolve sealed Curse", resolveSealed)
end

function resolveSealed()
    if #sealedTokens == 0 then
      broadcastToAll("No tokens sealed.", "Red")
      return
    end
    local closestMatColor = playmatApi.getMatColorByPosition(self.getPosition())
    local mat = guidReferenceApi.getObjectByOwnerAndType(closestMatColor, "Playermat")
    guidToBeResolved = table.remove(sealedTokens)
    chaosBagApi.drawChaosToken(mat, true, _, guidToBeResolved)
end