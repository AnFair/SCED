local searchLib       = require("util/SearchLib")
local tokenManagerApi = require("tokens/TokenManagerApi")

local hasSpawned = false

function onHover()
  if self.held_by_color == nil then
    matchCardBelow()
  end
end

function matchCardBelow()
  if hasSpawned then return end
  local searchResult = searchLib.belowPosition(self.getPosition(), "isCard")
  if #searchResult > 0 then
    local result = tokenManagerApi.addUseToCard(searchResult[1], "resource")
    if result then
      hasSpawned = true
      Wait.time(function() self.destruct() end, 0.15)
    end
  end
end

function tryObjectEnterContainer(_, object)
  if object == self then
    self.destruct()
    return false
  end
end
